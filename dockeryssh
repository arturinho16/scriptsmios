#!/bin/bash
# -----------------------------------------------------------
# Script para preparar servidor Ubuntu con Docker, Compose y SSH personalizado
# Versi√≥n: 1.1
# Autor: Artur
# -----------------------------------------------------------

echo "=== 1Ô∏è‚É£ Actualizando el servidor ==="
sudo apt update -y && sudo apt upgrade -y
sudo apt autoremove -y

echo "=== 2Ô∏è‚É£ Instalando Docker y Docker Compose ==="
sudo apt install -y curl docker.io

echo "=== üê≥ Descargando Docker Compose desde GitHub ==="
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

echo "=== üîß Dando permisos de ejecuci√≥n a docker-compose ==="
sudo chmod +x /usr/local/bin/docker-compose

echo "=== üë§ Agregando el usuario actual al grupo docker ==="
sudo usermod -aG docker $USER

echo "=== üîç Verificando instalaci√≥n de Docker Compose ==="
docker-compose --version

echo "=== 3Ô∏è‚É£ Instalando y configurando OpenSSH ==="
sudo apt install -y openssh-server

echo "=== üîß Configurando SSH en puerto 222 y habilitando contrase√±as ==="
sudo sed -i 's/#Port 22/Port 222/' /etc/ssh/sshd_config
sudo sed -i 's/#PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config
sudo sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config

echo "=== üöÄ Reiniciando el servicio SSH ==="
sudo systemctl enable ssh
sudo systemctl restart ssh

echo "=== ‚úÖ Instalaci√≥n completa ==="
echo "Docker versi√≥n:"
docker --version
echo "Docker Compose versi√≥n:"
docker-compose --version
echo "SSH est√° configurado en el puerto 222"
echo "Con√©ctate con: ssh tu_usuario@IP -p 222"
echo "‚ö†Ô∏è IMPORTANTE: Reinicia el servidor o cierra sesi√≥n para aplicar el grupo docker"
